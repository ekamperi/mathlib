#define _XOPEN_SOURCE 600

#include <atf-c.h>
#include <math.h>
#include <stdio.h>
#include <stdlib.h>

#include "subr_fpcmp.h"

struct tentry {
	double x;       /* Input */
	double y;       /* asinh output */
} ttable[] = {
	{ 196.09425407407635302328634920450182,
	 5.97174911372113859554618447300657915 },
	{ 673.05636063548773990460109239183329,
	 7.20497680394041747316123011014674906 },
	{ 827.42526033398954152161007496499429,
	 7.41146632905317953898959427492920444 },
	{ 549833.66606339018820420014739286750,
	 13.91051826669037027936612836848723817 },
	{ 560144.13205328804464445452756727856,
	 13.92909658882245299803928477914450333 },
	{ 956647.74373357182005612222266831507,
	 14.46433769936284735983420119654421112 },
	{ 9.9151045568153738573226422551958463E7,
	 19.1053021387511525484055176568569578  },
	{ 5.2669261769113770232095879965658276E8,
	 20.7752748487602906680778534617640116 },
	{ 9.1310992957223271467976667988947095E8,
	 21.3255140166599769582922641888934413 },
	{ 2.9491813016472331498632339573473178E11,
	 27.10311081046367967710389157839238648 },
	{ 4.4837037773282612522324065680832346E11,
	 27.5220326443741376961564316729435128 },
	{ 7.9716080320735876001978121976635403E11,
	 28.0974694365571281721765883614326705 },
	{ 1.6034865819651486959250849360385185E14,
	 33.4015188546257912404221358246479576 },
	{ 2.7192081737511793678658553922954401E14,
	 33.92967920781151681244316971447688384 },
	{ 4.1729986117679415537344527975476966E14,
	 34.3579733514159095266469918164209714 },
	{ 5.1014118030990973957636467837460565E17,
	  41.4666110870173482029568933244125325 },
	{ 5.3896751987178116719756906153295908E17,
	 41.52157888458577975086718105610532740 },
	{ 8.2366199893503353017218065848550700E17,
	 41.94568382575973567781667334818019284 },
	{ 1.9337169304722615729786709173347829E20,
	 47.40429306195724194785815816447729456 },
	{ 2.5573437021318443909583382604509771E20,
	 47.68381814388105953792432328717452982 },
	{ 6.1215901404349949486718188383481424E20,
	 48.5566709300844019744223554764518960 },
	{ 3.9746474007591480210481845306840542E22,
	 52.7299552663892592494414420743479467 },
	{ 6.3947578192005947576720028996417934E22,
	 53.20549779040654993454871986429192613 },
	{ 8.0527412050590933014912548618347142E22,
	 53.4360317822624286273476986170700432 },
	{ 2.2192936481896021879319464932602012E25,
	 59.0549634741752259704609840162810133 },
	{ 5.9027964664679631644990678414858345E26,
	 62.3357858143924669268429912181380327 },
	{ 7.7352697439423794717189283745550074E26,
	 62.60614995498854341937293845949398578 },
	{ 3.4261705179192747829906164209204105E29,
	 68.69955804777254050400218226333895678 },
	{ 5.7416415881169990456872936284879767E29,
	 69.2158600377922754001292047886211699 },
	{ 7.6339919108096551228886715262881855E29,
	 69.5007257720830313986599236805064540 },
	{ 6.3115516129470295450802736196691117E31,
	 73.91566660715660670761393362977734364 },
	{ 1.6669210972388584836925182744285950E32,
	 74.8868484268276138228057961057874532 },
	{ 6.4879757348499855400631668708723035E32,
	 76.2458207331708990108459548814284015 },
	{ 3.7727167927723002917434339187969402E36,
	 84.91400590496062357251767742261274264 },
	{ 4.1769412565287763965776049788128826E36,
	 85.0157897502062594101505226939879233 },
	{ 7.0267396260876940828460122383516412E36,
	 85.5359333465160478732660596208923677}
};

/*
 * Test case 1 -- Basic functionality
 */
ATF_TC(test_asinh1);
ATF_TC_HEAD(test_asinh1, tc)
{
	atf_tc_set_md_var(tc,
	    "descr",
	    "Basic functionality based on a set of good (x, asinh(x)) pairs");
}
ATF_TC_BODY(test_asinh1, tc)
{
	size_t i, N;

	N = sizeof(ttable) / sizeof(ttable[0]);
	for (i = 0; i < N; i++) {
		ATF_CHECK(fpcmp_equal(asinh(ttable[i].x), ttable[i].y));
	}
}

/*
 * Test case 2 -- Edge cases
 */
struct t2entry {
	double x;       /* Input */
	double y;       /* asinh output */
} t2table[] = {
	/* If x is NaN, a NaN shall be returned */
#ifdef	NAN
	{ NAN, NAN },
#endif

	/* If x is +-0, or +-Inf, x shall be returned */
	{  0.0,  0.0 },
	{ -0.0, -0.0 },

#ifdef	INFINITY
	{  INFINITY,  INFINITY },
	{ -INFINITY, -INFINITY },
#endif
#ifdef	HUGE_VAL
	{  HUGE_VAL,  HUGE_VAL },
        { -HUGE_VAL, -HUGE_VAL },
#endif
#ifdef	HUGE_VALF
	{  HUGE_VALF,  HUGE_VALF },
        { -HUGE_VALF, -HUGE_VALF },
#endif
#ifdef	HUGE_VALL
	{  HUGE_VALL,  HUGE_VALL },
        { -HUGE_VALL, -HUGE_VALL }
#endif
};

ATF_TC(test_asinh2);
ATF_TC_HEAD(test_asinh2, tc)
{
	atf_tc_set_md_var(tc,
	    "descr",
	    "Check some edge cases");
}
ATF_TC_BODY(test_asinh2, tc)
{
	size_t i, N;
	double oval;    /* output value */

	N = sizeof(t2table) / sizeof(t2table[0]);
	for (i = 0; i < N; i++) {
		oval = asinh(t2table[i].x);
		ATF_CHECK(fpcmp_equal(oval, t2table[i].y));
	}
}

/* Add test cases to test program */
ATF_TP_ADD_TCS(tp)
{
	ATF_TP_ADD_TC(tp, test_asinh1);
	ATF_TP_ADD_TC(tp, test_asinh2);

	return atf_no_error();
}
